<project name="CBM Test" default="test" basedir=".">
    	<description>
        	CBM Test Package
    	</description>

  	<!-- set global properties for this build -->
  	<property name="test.reports.dir" location="${report.dir}"/>
	<property name="test.data.dir" location="${output.dir}"/>
	<property name="test.bin.dir" location="bin"/>

  

  <target name="test">
  	<echo>${test.bin.dir}</echo>
  	<!-- Create the time stamp -->
	<tstamp><format property="directory.timestamp"  pattern="MMddyyyy_hhmmss"/></tstamp>
  	<echo>Timestamp: ${directory.timestamp}</echo>
    
  	<!-- Create the build directory structure used by compile -->
  	<mkdir dir="${test.reports.dir}/${TSTAMP}"/>
	<mkdir dir="${test.data.dir}/${TSTAMP}"/>
  	
    <echo>Testing against CBM node: ${cbm.url}</echo>
    	<junit fork="yes" haltonfailure="no" >
    		<jvmarg value="-Dcbm.url=${cbm.url}"/>
    		<classpath>
    		      <pathelement path="${classpath}"/>
    				<fileset dir="lib">
    					<include name="**/*.jar"/>
    				</fileset>
    				<dirset dir="${test.bin.dir}">
    					<include name="**/**"/>
    				</dirset>
    		    </classpath>
    		
    		
    		
    		<batchtest todir="${test.data.dir}">
    			
    			<formatter type="xml"/>
    			<fileset dir="${test.bin.dir}" includes="**/*Tests*.class" />	
    			
    		</batchtest>
    		
    		
    	</junit>

    	<junitreport todir="${test.data.dir}/${TSTAMP}">
       	<fileset dir="${test.data.dir}/${TSTAMP}">
      		<include name="TEST-*.xml"/>
       	</fileset>
    	<report todir="${test.reports.dir}"/>
  	</junitreport>

  </target>

</project>